# NFT Marketplace Backend - Technical Architecture Document

## 1. Overview

`digital-fund-backend` is a high-performance backend service written in Go, designed to provide API support for an NFT marketplace or aggregator. It adopts a classic layered architecture, achieving clear separation of business logic, data access, and API interfaces.

## 2. Tech Stack

*   **Language:** [Go](https://go.dev/) (Version 1.24+)
*   **Web Framework:** [Gin](https://github.com/gin-gonic/gin) - A lightweight, high-performance Go Web framework.
*   **Database ORM:** [GORM](https://gorm.io/) - One of the most comprehensive ORM libraries in the Go ecosystem.
*   **Database:** [MySQL](https://www.mysql.com/) (Connected via GORM's MySQL driver).
*   **Config Management:** [Viper](https://github.com/spf13/viper) - For handling complex configuration files and environment variables.
*   **Logging:** [Zap](https://github.com/uber-go/zap) - High-performance structured logging library by Uber.
*   **API Docs Generation:** [Swaggo](https://github.com/swaggo/swag) - Automatically generates Swagger/OpenAPI documentation by parsing code comments.
*   **Local Dependency:** The project depends on a local shared library `digital-fund-base` for storing code reused across projects.

## 3. Project Structure & Layering

The project adopts a clear, separation-of-concerns layered architecture.

```
src/
├── main.go       # App entry, responsible for initialization and starting service
├── api/          # API Interface Layer
│   ├── router/   # Gin router definitions
│   ├── v1/       # v1 API Request Handlers
│   └── middleware/ # Gin Middlewares (Auth, Cache)
├── service/      # Business Logic Layer, handles core business flows
├── dao/          # Data Access Layer, handles CRUD with database
├── config/       # Config file loading and management
├── types/        # Go struct definitions, especially API request/response bodies
├── errcode/      # Custom error codes
└── docs/         # Swagger docs generated by Swaggo
```

### 3.1. `digital-fund-base` Shared Library

*   The `replace` directive in `go.mod` indicates that this project depends on a local `digital-fund-base` repository.
*   The purpose of this shared library is to store code that can be reused between multiple backend services (if any), such as:
    *   **GORM Model Definitions:** Go structs for all database tables.
    *   **Blockchain Tools:** Common functions for interacting with `go-ethereum`.
    *   **Common Error Codes and Utility Functions.**

## 4. Core Architecture & Data Flow

A typical API request goes through the following processing flow:

1.  **Routing & Middleware (`api/router`, `api/middleware`):**
    *   User HTTP requests first reach the Gin engine.
    *   Gin engine matches the request to the corresponding handler based on the routing table defined in `api/router/v1.go`.
    *   Before reaching the handler, the request passes through necessary middleware, e.g., `AuthMiddleWare` checks the Token in the request header to verify identity, `CacheApi` attempts to return response directly from cache.

2.  **API Handler (`api/v1`):**
    *   Handler functions are responsible for parsing and validating requests.
    *   It extracts data from URL path, query parameters, or request body and binds it to Go structs defined in `types`.
    *   The handler itself does not contain complex business logic; its duty is to call the corresponding function in the `service` layer to process the request.

3.  **Business Logic Layer (`service`):**
    *   The `service` layer is the core of business logic. It is responsible for executing specific tasks, such as "Get detailed info of an NFT collection and its latest bids".
    *   A service function may coordinate multiple `dao` layer functions. For example, it might need to fetch collection info from `collections_dao` first, then bid info from `bids_dao`.
    *   It may also contain logic for interacting with blockchain nodes (via `go-ethereum`) or calling other microservices.

4.  **Data Access Layer (`dao`):**
    *   The `dao` layer is the only layer interacting directly with the database.
    *   It uses GORM to execute SQL queries. Each `dao` file typically corresponds to a database table and provides CRUD methods for that table.
    *   This layering ensures decoupling of business logic and data storage. If migration from MySQL to another database is needed in the future, the main changes will be in the `dao` layer.

5.  **Response Return:**
    *   The `service` layer returns processing results to the `api` handler.
    *   The handler serializes the Go struct into JSON format and returns it as an HTTP response to the client.

## 5. Database

*   The project uses GORM as ORM, making database operations more convenient and secure, effectively preventing SQL injection.
*   Database models (table struct definitions) are likely located in the shared `digital-fund-base` repository for reuse across services.
*   The database used is MySQL.

## 6. Summary

`digital-fund-backend` is a robust API service following modern Go development practices. Its layered architecture and use of ORM and Swagger demonstrate that the project was designed with maintainability, scalability, and development efficiency in mind.
